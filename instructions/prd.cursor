PRD Complet - Stack Python

Document de spÃ©cifications dÃ©taillÃ©
1 Vue d'ensemble
ğŸ¯ Objectif

CrÃ©er un systÃ¨me de kiosque self-service permettant aux utilisateurs de rechercher et demander des films, sÃ©ries et animÃ©s qui seront automatiquement tÃ©lÃ©chargÃ©s et intÃ©grÃ©s Ã  Plex.
ğŸ‘¥ Utilisateurs cibles

    â€¢ Membres du foyer/famille
    â€¢ Amis avec accÃ¨s Plex
    â€¢ Administrateur Plex

2 FonctionnalitÃ©s
ğŸ” Recherche & DÃ©couverte

    âœ“ Recherche unifiÃ©e (films, sÃ©ries, animÃ©s)
    âœ“ IntÃ©gration TMDB, TVDB, AniList, MAL
    âœ“ Suggestions & recommandations
    âœ“ Filtres par genre, annÃ©e, note

ğŸ¤– Module IA (AnimÃ©s)

    âœ“ RÃ©solution des noms alternatifs
    âœ“ Scoring intelligent des torrents
    âœ“ Renommage automatique Plex
    âœ“ DÃ©tection qualitÃ©/sous-titres

â¬‡ï¸ TÃ©lÃ©chargement

    âœ“ Scraping YGGtorrent + bypass CF
    âœ“ Queue de tÃ©lÃ©chargement
    âœ“ Gestion automatique des prioritÃ©s
    âœ“ Support qBittorrent/Transmission

ğŸ“º IntÃ©gration Plex

    âœ“ Scan automatique des librairies
    âœ“ VÃ©rification doublons
    âœ“ Notifications utilisateur
    âœ“ MÃ©tadonnÃ©es enrichies

3 Architecture Technique

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FRONTEND â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Vanilla JS â”‚ â”‚ Tailwind CSS â”‚ â”‚ Alpine.js â”‚ â”‚
â”‚ â”‚ + HTMX â”‚ â”‚ â”‚ â”‚ (interactions) â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚ HTTP/WebSocket
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BACKEND (FastAPI) â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ API REST â”‚ â”‚ WebSocket â”‚ â”‚ Auth â”‚ â”‚ Background Tasks â”‚ â”‚
â”‚ â”‚ Endpoints â”‚ â”‚ Server â”‚ â”‚ JWT â”‚ â”‚ (Celery) â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚ â”‚ â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SERVICES LAYER â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Media Search â”‚ â”‚ Torrent â”‚ â”‚ AI Agent â”‚ â”‚ Plex Manager â”‚ â”‚
â”‚ â”‚ Service â”‚ â”‚ Service â”‚ â”‚ (Claude) â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ TMDB/AniList â”‚ â”‚ YGG+CF â”‚ â”‚ â”‚ â”‚ â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚ â”‚ â”‚ â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ EXTERNAL SERVICES â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ TMDB â”‚ â”‚ AniList â”‚ â”‚ FlareSolverr â”‚ â”‚ Redis â”‚ â”‚ qBittorrent/ â”‚ â”‚
â”‚ â”‚ API â”‚ â”‚ API â”‚ â”‚ (CF bypass) â”‚ â”‚ Queue â”‚ â”‚ Transmission â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DATA LAYER â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ SQLite/PostgreSQL â”‚ â”‚ File System â”‚ â”‚
â”‚ â”‚ - Users & Requests â”‚ â”‚ - Media Files â”‚ â”‚
â”‚ â”‚ - Download History â”‚ â”‚ - Thumbnails Cache â”‚ â”‚
â”‚ â”‚ - AI Rules & Mappings â”‚ â”‚ - Logs â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        

ğŸ Backend Python

    â€¢ FastAPI - Framework async
    â€¢ Pydantic - Validation
    â€¢ SQLAlchemy - ORM
    â€¢ Celery - Task queue
    â€¢ httpx - HTTP client

ğŸŒ Scraping

    â€¢ FlareSolverr - CF bypass
    â€¢ BeautifulSoup4 - Parsing
    â€¢ lxml - Parser rapide
    â€¢ cloudscraper - Backup

ğŸ¤– IA Integration

    â€¢ anthropic - Claude API
    â€¢ openai - GPT backup
    â€¢ Prompts structurÃ©s
    â€¢ Cache des dÃ©cisions

4 Module IA - RÃ¨gles de Recherche AnimÃ©s
ğŸ¯ Workflow IA
1. RÃ©solution Noms

L'IA analyse les noms alternatifs (romaji, kanji, anglais) via AniList/MAL
2. Scoring Torrents

Ã‰valuation basÃ©e sur: groupe, qualitÃ©, seeders, taille, sous-titres
3. Renommage Plex

Format: Show Name (Year) - SXXEXX - Episode Title.ext
ğŸ“‹ RÃ¨gles de Scoring Torrent
Groupes prÃ©fÃ©rÃ©s (SubsPlease, Erai-raws...) +50 pts
RÃ©solution 1080p +30 pts
HEVC/x265 (efficacitÃ©) +20 pts
Batch complet +25 pts
Dual audio (VOSTFR+VO) +40 pts
Seeders > 10 +15 pts
Cam/TS quality -100 pts
Hardcoded subs -30 pts
ğŸ”„ Exemple de Prompt IA

Tu es un expert en anime et en gestion de mÃ©diathÃ¨que Plex.

TÃ‚CHE: Analyser les torrents suivants pour l'anime "Shingeki no Kyojin" (Attack on Titan)

TORRENTS DISPONIBLES:
1. [SubsPlease] Shingeki no Kyojin S04 (1080p) [Batch] - 45.2GB - 156 seeders
2. [Judas] Attack on Titan S04 Complete (1080p x265) - 12.1GB - 89 seeders  
3. shingeki_no_kyojin_final_720p_HardSub - 8.5GB - 23 seeders

RÃˆGLES:
- PrÃ©fÃ©rer les groupes reconnus (SubsPlease, Erai-raws, Judas)
- 1080p minimum sauf si indisponible
- HEVC/x265 prÃ©fÃ©rÃ© pour l'espace disque
- Ã‰viter les hardsubs
- VÃ©rifier la complÃ©tude de la saison

RÃ‰PONSE ATTENDUE (JSON):
{
  "best_choice": 2,
  "reasoning": "...",
  "plex_naming": "Attack on Titan (2013)/Season 04/Attack on Titan (2013) - S04E01 - ...",
  "confidence": 0.95
}
                            

5 API Endpoints
GET
/api/v1/search

Recherche unifiÃ©e (films, sÃ©ries, animÃ©s)
Params: q, type, year, page
POST
/api/v1/requests

CrÃ©er une nouvelle demande de mÃ©dia
Body: media_id, media_type, quality_preference
GET
/api/v1/torrents/search

Recherche de torrents sur YGGtorrent (avec bypass CF)
Params: query, category
POST
/api/v1/ai/analyze-torrents

Analyse IA pour sÃ©lection du meilleur torrent
Body: media_info, torrents[]
POST
/api/v1/plex/scan

DÃ©clencher un scan de librairie Plex
Body: library_id (optional)
GET
/api/v1/downloads/status

Ã‰tat des tÃ©lÃ©chargements en cours
WebSocket disponible: /ws/downloads
6 Structure du Projet

plex-kiosk/
â”œâ”€â”€ ğŸ“ backend/
â”‚ â”œâ”€â”€ ğŸ“ app/
â”‚ â”‚ â”œâ”€â”€ __init__.py
â”‚ â”‚ â”œâ”€â”€ main.py # FastAPI app entry
â”‚ â”‚ â”œâ”€â”€ config.py # Settings & env vars
â”‚ â”‚ â”œâ”€â”€ ğŸ“ api/
â”‚ â”‚ â”‚ â”œâ”€â”€ v1/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ search.py # Search endpoints
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ requests.py # Request endpoints
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ torrents.py # Torrent endpoints
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ plex.py # Plex endpoints
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ ai.py # AI endpoints
â”‚ â”‚ â”œâ”€â”€ ğŸ“ services/
â”‚ â”‚ â”‚ â”œâ”€â”€ media_search.py # TMDB/AniList integration
â”‚ â”‚ â”‚ â”œâ”€â”€ torrent_scraper.py # YGG + FlareSolverr
â”‚ â”‚ â”‚ â”œâ”€â”€ ai_agent.py # Claude/GPT integration
â”‚ â”‚ â”‚ â”œâ”€â”€ plex_manager.py # Plex API wrapper
â”‚ â”‚ â”‚ â”œâ”€â”€ downloader.py # qBittorrent/Transmission
â”‚ â”‚ â”‚ â””â”€â”€ file_renamer.py # Plex naming convention
â”‚ â”‚ â”œâ”€â”€ ğŸ“ models/
â”‚ â”‚ â”‚ â”œâ”€â”€ database.py # SQLAlchemy setup
â”‚ â”‚ â”‚ â”œâ”€â”€ user.py
â”‚ â”‚ â”‚ â”œâ”€â”€ request.py
â”‚ â”‚ â”‚ â””â”€â”€ download.py
â”‚ â”‚ â”œâ”€â”€ ğŸ“ schemas/
â”‚ â”‚ â”‚ â””â”€â”€ *.py # Pydantic schemas
â”‚ â”‚ â””â”€â”€ ğŸ“ tasks/
â”‚ â”‚ â””â”€â”€ celery_worker.py # Background tasks
â”‚ â”œâ”€â”€ requirements.txt
â”‚ â”œâ”€â”€ Dockerfile
â”‚ â””â”€â”€ .env.example
â”œâ”€â”€ ğŸ“ frontend/
â”‚ â”œâ”€â”€ index.html # Main SPA
â”‚ â”œâ”€â”€ ğŸ“ static/
â”‚ â”‚ â”œâ”€â”€ css/
â”‚ â”‚ â”‚ â””â”€â”€ styles.css # Tailwind build
â”‚ â”‚ â””â”€â”€ js/
â”‚ â”‚ â”œâ”€â”€ app.js # Main app logic
â”‚ â”‚ â”œâ”€â”€ api.js # API client
â”‚ â”‚ â””â”€â”€ components/ # Alpine.js components
â”‚ â””â”€â”€ ğŸ“ templates/ # HTMX partials
â”œâ”€â”€ ğŸ“ docker/
â”‚ â”œâ”€â”€ docker-compose.yml
â”‚ â””â”€â”€ docker-compose.dev.yml
â”œâ”€â”€ ğŸ“ scripts/
â”‚ â””â”€â”€ setup.sh
â””â”€â”€ README.md
                    

7 Roadmap
Phase 1
MVP Core (2 semaines)

    âœ“ Setup FastAPI + DB
    âœ“ Recherche TMDB basique
    âœ“ Scraping YGG + FlareSolverr
    âœ“ Interface kiosque simple

Phase 2
AnimÃ©s + IA (2 semaines)

    â—‹ IntÃ©gration AniList/MAL
    â—‹ Module IA scoring torrents
    â—‹ Renommage automatique
    â—‹ Gestion noms alternatifs

Phase 3
Plex Integration (1 semaine)

    â—‹ API Plex complÃ¨te
    â—‹ Scan auto post-download
    â—‹ DÃ©tection doublons
    â—‹ Notifications

Phase 4
Polish & Deploy (1 semaine)

    â—‹ UI/UX amÃ©liorations
    â—‹ Docker compose production
    â—‹ Documentation
    â—‹ Tests & monitoring
